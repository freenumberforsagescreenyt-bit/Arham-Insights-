<!DOCTYPE html>
<html lang="hi">
<head>
    <meta name="profiton-domain-verification" content="a2b684f41a276c23232dd6f892cb49938215bd6b7f68c8f6b9e41695402d0bab"/>
    <meta name='admaven-placement' content='Bqjw6rdC5'>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arham Insights | Premium Learning</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #ff9933; --dark: #070b14; --card-bg: rgba(255,255,255,0.05); --text-gray: #94a3b8; }
        body { font-family: 'Poppins', sans-serif; background: var(--dark); color: white; text-align: center; margin: 0; padding-top: 80px; overflow-x: hidden; }
        #timer-container { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: var(--primary); color: black; padding: 12px 30px; font-weight: 800; border-radius: 50px; z-index: 100000; box-shadow: 0 5px 20px rgba(255,153,51,0.6); min-width: 160px; }
        
        .ad-slot { min-height: 100px; margin: 20px auto; background: var(--card-bg); padding: 15px; border-radius: 15px; width: 95%; max-width: 728px; border: 1px solid rgba(255,255,255,0.1); overflow: hidden; display: flex; justify-content: center; align-items: center; }
        
        main { padding: 10px 20px; max-width: 850px; margin: 0 auto; }
        #task-content p { margin-bottom: 20px; line-height: 1.8; text-align: left; color: #e2e8f0; font-size: 1.05rem; }
        
        /* Unique Quote Style - Always at Top */
        .unique-quote-box { background: linear-gradient(45deg, rgba(255,153,51,0.15), rgba(255,255,255,0.05)); border-radius: 15px; padding: 20px; margin: 15px auto; width: 95%; max-width: 728px; border: 1px dashed var(--primary); font-style: italic; font-weight: 600; color: #fff; }
        
        #status-overlay { display: none; position: fixed; inset: 0; background: rgba(7, 11, 20, 0.98); z-index: 200000; flex-direction: column; align-items: center; justify-content: center; }
        .loader-spin { width: 50px; height: 50px; border: 5px solid var(--card-bg); border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="status-overlay">
        <div id="status-loader" class="loader-spin"></div>
        <div id="status-msg" style="margin-top:20px; color:var(--primary); font-weight:bold;">Verifying Your Reward...</div>
    </div>

    <div id="timer-container">⏳ समय शेष: <span id="timer">05:00</span></div>

    <main>
        <div class="ad-slot" id="top-ad-refresh">
            <script> atOptions = { 'key' : 'ac3a34c448d39282025c11644797e3a1', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} }; </script>
            <script src="https://www.highperformanceformat.com/ac3a34c448d39282025c11644797e3a1/invoke.js"></script>
        </div>

        <h2 id="task-title" style="color:var(--primary); font-weight: 800;">Premium Learning</h2>
        
        <div id="unique-motivation" class="unique-quote-box">"जितना बड़ा संघर्ष होगा, सफलता उतनी ही शानदार होगी।"</div>

        <div id="task-content">
            <p>कंटेंट लोड हो रहा है, कृपया प्रतीक्षा करें...</p>
        </div>

        <div class="ad-slot" id="bottom-ad-refresh">
             <script async="async" data-cfasync="false" src="https://pl28481408.effectivegatecpm.com/b104bb133c0e3abf10d65c6dca934730/invoke.js"></script>
             <div id="container-b104bb133c0e3abf10d65c6dca934730"></div>
        </div>
    </main>

    <script>
        const _supabase = supabase.createClient("https://mkzgmrxakattqgbjnwch.supabase.co", "sb_publishable_Div0TjlgvUbXNlwVqNGuag_-dPli5uL");
        let currentUser = null;
        let taskId = new URLSearchParams(window.location.search).get('id') || "General_Task";

        async function init() {
            const { data: { session } } = await _supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                const isAllowed = await checkDailyLimit();
                if(!isAllowed) {
                    alert("Daily Limit Reached! कल फिर आएं।");
                    window.location.href = "dashboard.html";
                    return;
                }
                await fetchAndProcessContent();
                startTaskTimer();
                setupAdRefresh();
            } else { window.location.href = "login.html"; }
        }

        async function checkDailyLimit() {
            const today = new Date().toISOString().split('T')[0];
            const { count } = await _supabase.from('user_work').select('*', { count: 'exact', head: true }).eq('username', currentUser.email).gte('created_at', today);
            return count < 100;
        }

        async function fetchAndProcessContent() {
            let { data } = await _supabase.from('admin_blogs').select('*').eq('id', taskId).maybeSingle();
            if (!data) {
                let { data: fallback } = await _supabase.from('admin_blogs').select('*').limit(1).maybeSingle();
                data = fallback;
            }

            if (data) {
                document.getElementById('task-title').innerText = data.keyword;
                
                // --- कंटेंट इंजेक्शन लॉजिक (Part-wise) ---
                let paragraphs = data.content.split('</p>');
                let totalParas = paragraphs.length;
                
                // 30% और 70% कंटेंट के बाद एड डालना
                let ad1Index = Math.floor(totalParas * 0.3);
                let ad2Index = Math.floor(totalParas * 0.7);

                let adBlock1 = `
                    <div class="ad-slot" id="mid-ad-1">
                        <script> atOptions = { 'key' : 'ac3a34c448d39282025c11644797e3a1', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} }; <\/script>
                        <script src="https://www.highperformanceformat.com/ac3a34c448d39282025c11644797e3a1/invoke.js"><\/script>
                    </div>
                `;
                
                let adBlock2 = `
                    <div class="ad-slot" id="mid-ad-2">
                        <ins class="e300x250" id="300x250" data-revive-hash="03f72371ba83e2e09e793c77727f82c4" data-revive-zoneid="65572" data-revive-id="f87497be83f6ed6b52c3b340d803ae0d"></ins>
                        <script async src="//network.eonads.com/adserver/www/delivery/asyncjs.php"><\/script>
                    </div>
                `;

                if (totalParas > 4) {
                    paragraphs.splice(ad2Index, 0, adBlock2);
                    paragraphs.splice(ad1Index, 0, adBlock1);
                    document.getElementById('task-content').innerHTML = paragraphs.join('</p>');
                } else {
                    document.getElementById('task-content').innerHTML = data.content + adBlock1;
                }
            }
        }

        function setupAdRefresh() {
            setInterval(() => {
                ['top-ad-refresh', 'mid-ad-1', 'mid-ad-2', 'bottom-ad-refresh'].forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.innerHTML = el.innerHTML; 
                });
            }, 60000); 
        }

        function startTaskTimer() {
            let totalTime = 300; 
            if (sessionStorage.getItem("active_timer")) totalTime = parseInt(sessionStorage.getItem("active_timer"));
            const timerDisplay = document.getElementById('timer');
            const countdown = setInterval(async () => {
                let m = Math.floor(totalTime / 60);
                let s = totalTime % 60;
                timerDisplay.textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
                if (totalTime <= 0) {
                    clearInterval(countdown);
                    sessionStorage.removeItem("active_timer");
                    await submitTask();
                } else {
                    totalTime--;
                    sessionStorage.setItem("active_timer", totalTime);
                }
            }, 1000);
        }

        async function submitTask() {
            document.getElementById('status-overlay').style.display = 'flex';
            const { error } = await _supabase.from('user_work').insert([{ username: currentUser.email, task_id: taskId, status: 'Success', amount: 5 }]);
            if (!error) {
                document.getElementById('status-msg').innerText = "Wallet Updated! Redirecting...";
                setTimeout(() => { window.location.href = "dashboard.html?status=success"; }, 1500);
            } else {
                document.getElementById('status-overlay').style.display = 'none';
                alert("Error saving task.");
            }
        }

        window.onload = init;
    </script>
</body>
</html>
